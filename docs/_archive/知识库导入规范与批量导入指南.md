# 知识库导入规范与批量导入指南

更新时间：2026-01-04

适用对象：甲方（数据提供/验收）、乙方（实施/运维）、管理端操作人员

---

## 1. 目的

本文档用于：

- 约定知识库导入的数据字段规范（JSON）
- 说明后台批量导入入口与接口调用方式
- 给出最小可验收流程：导入 → 向量化 → 检索验证

---

## 2. 数据格式（JSON）

### 2.1 顶层结构

支持两种请求体结构：

- 直接数组：

```json
[
  {
    "knowledge_type": "law",
    "title": "...",
    "content": "...",
    "category": "民法"
  }
]
```

- 包装结构：

```json
{
  "items": [
    {
      "knowledge_type": "law",
      "title": "...",
      "content": "...",
      "category": "民法"
    }
  ],
  "dry_run": false
}
```

后台接口最终接收结构为：

```json
{
  "items": [ ... ],
  "dry_run": false
}
```

### 2.2 字段定义

- `knowledge_type`：知识类型（必填）

  - `law`：法律条文
  - `case`：案例
  - `regulation`：法规/规章
  - `interpretation`：司法解释

- `title`：标题（必填）
- `article_number`：条款编号/案例编号（可选）
- `content`：正文内容（必填）
- `summary`：摘要/要点（可选）
- `category`：分类（必填，如“民法/刑法/劳动法/合同法”等）
- `keywords`：关键词（可选，逗号分隔）
- `source`：来源/出处（可选）
- `effective_date`：生效日期（可选，字符串）
- `weight`：权重（可选，默认 1，范围 0-10）
- `is_active`：是否启用（可选，默认 true）

---

## 3. 示例数据

```json
[
  {
    "knowledge_type": "law",
    "title": "中华人民共和国民法典",
    "article_number": "第1条",
    "content": "为了保护民事主体的合法权益，调整民事关系，维护社会和经济秩序，适应中国特色社会主义发展要求，弘扬社会主义核心价值观，根据宪法，制定本法。",
    "summary": "民法典立法目的",
    "category": "民法",
    "keywords": "民法典,立法目的",
    "source": "民法典",
    "effective_date": "2021-01-01",
    "weight": 1,
    "is_active": true
  }
]
```

---

## 4. 导入方式

### 4.1 管理后台导入（推荐）

入口：管理后台 → 知识库管理 → `批量导入`

操作步骤：

1. 粘贴 JSON 数组
2. 勾选/不勾选 `仅校验（dry_run）`
3. 点击提交
4. 导入完成后刷新列表与统计

### 4.2 接口导入（可用于自动化/脚本）

接口：`POST /api/knowledge/laws/batch-import`

请求体：

```json
{
  "items": [ ... ],
  "dry_run": false
}
```

说明：

- `dry_run=true`：只做格式校验，不写入数据库
- 写入模式采用简易 upsert（以 `knowledge_type + title + article_number` 为唯一匹配键），命中则覆盖内容并置 `is_vectorized=false`

---

## 5. 导入后向量化与验证

### 5.1 向量化

- 单条向量化：`POST /api/knowledge/laws/{knowledge_id}/vectorize`
- 批量向量化：`POST /api/knowledge/laws/batch-vectorize`
- 同步所有未向量化：`POST /api/knowledge/sync-vector-store`

### 5.2 验证建议

- 在导入后选取 1-3 条数据执行向量化
- 在 AI 咨询中提问包含该条目关键词的内容，检查引用与答案是否能检索到对应法条

---

## 6. 责任边界（最小约定）

- 甲方负责：数据来源合法合规、内容准确性、分类/关键词口径确认
- 乙方负责：导入工具可用、字段校验与失败提示、向量化与检索链路可运行
