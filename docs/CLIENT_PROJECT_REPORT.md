# 甲方项目功能报告（交付版）

项目名称：百姓法律助手（百姓助手）

版本：v1.1

更新时间：2026-01-06

交付对象：甲方（业务/产品/验收）

---

## 1. 项目概述

百姓法律助手是一站式法律服务平台，覆盖 **AI 法律咨询、新闻资讯、论坛社区、律所/律师服务、法律工具、支付订单、通知系统、管理后台** 等能力，支持 **Web 端（PC/移动端自适应）**，并提供后端 API 与可部署交付（Docker Compose / Kubernetes Helm）。

- **定位**

  - 面向大众用户的法律服务入口：咨询、资讯、社区、服务采购。
  - 面向运营/管理员的内容与风控后台：审核、配置、统计、运维。

- **交付形态**
  - 前端：React SPA（路由 + 响应式布局，支持暗色模式、多语言切换）。
  - 后端：FastAPI（REST API + WebSocket，含后台管理与运维接口）。
  - 部署：支持 Docker Compose 一键启动、Helm Chart 上 K8s。

---

## 2. 用户角色与权限模型

- **游客**

  - 可浏览公开内容（新闻/论坛列表等）。
  - AI 咨询存在“游客配额/限流”机制（按 IP 维度限制）。

- **普通用户（user）**

  - 登录后可发布论坛帖子、评论、收藏/订阅等。
  - 可使用个人中心、通知、法律工具等。

- **律师用户（lawyer）**

  - 通过“律师认证申请 → 管理员审核”后获得律师身份。
  - 可访问律师工作台处理用户咨询预约（接单/拒单/标记完成等，按当前实现范围验收）。
  - 可访问律师结算与提现能力：钱包、收入明细、收款账户管理、提现申请与记录。

- **管理员（admin / super_admin）**
  - 可访问管理后台：新闻管理、论坛管理、用户管理、系统设置、日志、通知、知识库等。

---

## 3. 前台功能清单（用户侧）

### 3.1 首页

- **核心入口**：AI 咨询、新闻解读、找律所、法律论坛、个人中心。
- **工具入口**：费用计算、诉讼时效计算、文书生成、法律日历。

验收要点：

- 首页可正常进入各模块。
- 移动端与 PC 端布局自适应。

### 3.2 AI 法律咨询（/chat）

- **对话咨询**：输入问题，获得 AI 回复。
- **流式输出（SSE）**：支持边生成边展示（提升体验）。
- **会话管理**：会话可持久化，可查看历史会话列表与详情。
- **引用/检索增强（可选）**：支持 RAG 思路，可返回引用条文（实现依赖向量库与知识库数据）。
- **导出/分享（可选能力）**：支持会话导出结构化数据；支持分享链接（按 token 分享）。

验收要点：

- 登录与非登录场景下的 AI 咨询均可触发。
- 返回内容结构化字段完整（answer、references 等）。
- 当 AI 模块未启用或缺少配置时，接口有明确错误提示。

### 3.3 新闻资讯与解读（/news）

- **新闻列表**：分页、分类/筛选、推荐/置顶等。
- **新闻详情**：内容展示、阅读量、评论。
- **订阅/收藏**：用户可管理订阅与收藏列表。
- **专题/合集**：专题列表、专题详情、专题新闻列表。

验收要点：

- 列表/详情访问正常。
- 订阅/收藏对登录态有正确限制。

### 3.4 News AI 内容加工（新闻的 AI 标注）

面向“内容运营提效”，对新闻内容生成：

- **摘要（summary）**
- **要点（highlights）**
- **关键词（keywords）**
- **风险等级（risk_level）**

该能力的落点：

- 用户在新闻详情页可看到 AI 标注结果（若已生成）。
- 管理端可对单条新闻执行 AI 重跑并查看结果。

验收要点：

- 对指定新闻触发 AI 生成后，新闻详情可查询到 `ai_annotation`。

### 3.5 论坛社区（/forum）

- **帖子列表/详情**：发帖、编辑、删除、草稿箱、回收站。
- **评论互动**：评论、回复、点赞。
- **内容治理**：敏感词与规则过滤；支持审核（后台）。
- **通知联动**：与通知系统打通，可对用户操作/审核结果进行通知。

验收要点：

- 登录用户可发帖评论。
- 触发审核/拦截时，用户能收到明确提示或通知。

### 3.6 律所/律师服务（/lawfirm）

- **律所列表**：按城市、关键词筛选。
- **律所详情**：基础信息、领域、评分等。
- **律师详情与预约咨询**：在律师详情页发起预约咨询，系统可生成咨询记录与（可选）咨询支付订单。
- **我的订单 / 我的预约（统一入口）**：`/orders` 支持切换 tab 查看“支付订单”与“律师预约”。（兼容入口：`/lawfirm/consultations` 会重定向到 `/orders?tab=consultations`）

验收要点：

- 列表与详情可访问；筛选正常。

### 3.7 法律工具

- **费用计算器（/calculator）**：用于估算诉讼/服务费用。
- **诉讼时效计算（/limitations）**：用于计算时效相关日期。
- **文书生成（/documents）**：提供模板化文书生成（起诉状/答辩状/协议/律师函）。
- **法律日历（/calendar）**：用户可创建提醒、查看提醒列表、标记完成、删除。

验收要点：

- 工具页面可打开并生成结果。
- 日历提醒 CRUD 对登录态有正确限制。

### 3.8 通知系统（/notifications）

- **通知列表**：支持分页、未读筛选。
- **未读计数**：可查询未读数量。
- **批量已读/删除**：提升运营与用户体验。
- **WebSocket 在线能力（可选）**：提供实时通知推送的基础能力。

验收要点：

- 登录用户可查看通知列表。
- 未读数与已读状态变化正确。

---

### 3.9 商业化与配额（VIP / 次数包）

- **VIP 会员**：支持购买 VIP（权益由系统设置可配置）。
- **次数包**：支持购买 AI 咨询/文书生成次数包。
- **配额展示与刷新**：用户可查看当日配额、剩余次数包余额（与支付成功后的额度刷新联动）。

验收要点：

- 购买 VIP / 次数包后，用户配额与权益可被正确刷新。
- 未登录（游客）场景下，AI 咨询/文书生成会触发游客配额/限流提示。

## 4. 管理后台功能清单（管理员侧）

后台入口：`/admin`（需管理员权限）

### 4.1 仪表盘

- 统计用户数、新闻数、帖子数、评论数、咨询数、律所数等。

### 4.2 用户管理

- 用户列表、状态管理等（按项目已有实现验收）。

### 4.3 新闻管理

- 新闻 CRUD、审核/发布、置顶。
- 新闻专题/合集管理。
- RSS 来源管理与采集运行记录。
- 新闻评论管理。

### 4.4 News AI 运维与配置

- 系统设置页支持 News AI 相关开关、策略与 response_format 配置。
- 运维状态接口可查看积压、错误趋势、providers 生效配置（脱敏）。

### 4.5 论坛管理

- 帖子/评论审核。
- 敏感词/规则配置。

### 4.6 律所管理

- 律所信息维护、启用/禁用、认证标记等。

### 4.7 知识库与咨询模板

- 法律知识条目 CRUD。
- 向量化（RAG 数据准备）：单条/批量/同步。
- 咨询模板管理。

### 4.8 操作日志与通知管理

- 操作日志查询。
- 通知管理（按实现范围）。

### 4.9 支付回调审计与对账（管理员）

- 提供支付回调事件的审计能力：列表、统计、幂等留痕。
- 支持微信平台证书刷新（用于微信支付 V3 回调验签）。
- 支持按订单号对账，输出诊断（无回调/验签失败/金额不一致等）。

后台入口：`/admin/payment-callbacks`

### 4.10 律师结算与提现（管理员）

- 提现申请管理：列表、审核、驳回原因。
- 结算统计：按日期/状态汇总。
- CSV 导出：提现记录、收入明细等（含脱敏策略）。

后台入口：

- `/admin/withdrawals`
- `/admin/settlement-stats`

---

## 5. 非功能性能力（稳定性/安全/可运维）

- **安全策略：Secrets 不入库**

  - API Key/Secret 等敏感信息必须通过环境变量/Secret Manager 注入。
  - 管理后台 SystemConfig 会阻止保存疑似 secret 的字段，并对响应内容进行脱敏。

- **限流/风控**

  - 后端对部分高风险接口（如 AI、文书生成等）有速率限制能力。

- **可运维**

  - 提供健康检查接口。
  - 提供 News AI 运维状态接口（积压/错误/配置生效情况）。

- **可交付**

  - Docker Compose 一键启动（含数据库/后端/前端）。
  - Helm Chart 支持 K8s 部署。
  - CI 校验包含后端测试、前端构建、Helm 渲染校验、类型检查等。

- **自动化回归（可持续交付）**
  - 已提供 Playwright E2E 覆盖关键业务链路（新闻/论坛/律所/支付/移动端回归等）。
  - 最新一次回归结果（2026-01-06）：
    - 后端 pytest：`95 passed`
    - Playwright E2E：`73 passed, 0 failed`
    - pyright / basedpyright：`0 errors/warnings`
  - 说明：为保证回归稳定性，部分榜单类能力（如热门新闻）在测试环境下使用专用调试接口进行数据准备。

---

## 6. 验收建议（建议清单）

建议以“场景驱动”方式验收，以下为推荐用例：

- **[用例 1] 用户注册/登录/个人中心**

  - 注册 -> 登录 -> 查看个人信息 -> 退出登录。

- **[用例 2] AI 咨询**

  - 输入法律问题 -> 返回答案 -> 查看引用/置信度等元信息 -> 查看历史会话。

- **[用例 3] 新闻消费 + News AI 标注**

  - 打开新闻列表 -> 进入详情 -> 查看评论。
  - 管理员触发 AI 重跑 -> 新闻详情出现 AI 标注字段。

- **[用例 4] 论坛发帖/评论/审核**

  - 用户发帖 -> 用户评论 -> 触发审核/敏感词拦截 -> 管理员审核 -> 用户收到通知。

- **[用例 5] 律所查询**

  - 列表筛选（城市/关键词）-> 详情页展示。

- **[用例 6] 支付订单 / 律师预约（闭环）**

  - 用户在律师详情页发起预约（如需收费则生成订单）。
  - 进入 `/orders`：
    - 在“支付订单”tab 完成余额支付或获取支付宝支付链接。
    - 在“律师预约”tab 查看预约状态、查看留言/评价等（按当前实现范围验收）。

- **[用例 7] 工具类能力**
  - 文书生成：起诉状/答辩状/协议/律师函。
  - 日历提醒：新增/编辑/完成/删除。

---

## 7. 交付清单与边界说明

- **交付物**

  - 前端应用（React）
  - 后端服务（FastAPI）
  - 数据库模型与迁移骨架
  - 部署脚手架（Docker Compose / Helm）
  - CI 工作流与工程化门禁

- **边界说明（可与甲方确认）**
  - 支付渠道（支付宝/微信）在当前实现中以接口/验签骨架为主；实际对接需要甲方提供支付平台参数与回调规范。
  - AI 供应商/模型可切换为 OpenAI-compatible；需要甲方提供 API Key 与接入地址。
  - RAG（向量库/知识库）效果依赖“知识库数据质量与向量化流程”，需要甲方明确数据来源与更新机制。

---

## 8. 联系方式与交付说明（占位）

- 乙方项目负责人：\***\*\_\_\_\_\*\***
- 乙方技术负责人：\***\*\_\_\_\_\*\***
- 交付日期：\***\*\_\_\_\_\*\***
- 交付范围确认：\***\*\_\_\_\_\*\***
