"""填充法律知识库数据"""
import asyncio
import sys
import os

# 添加项目根目录到路径
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from app.database import AsyncSessionLocal, init_db
from app.models.knowledge import LegalKnowledge


# 法律知识数据
LEGAL_KNOWLEDGE_DATA = [
    # 民法典 - 总则编
    {
        "title": "民法典第一条",
        "category": "民法典",
        "subcategory": "总则编",
        "content": "为了保护民事主体的合法权益，调整民事关系，维护社会和经济秩序，适应中国特色社会主义发展要求，弘扬社会主义核心价值观，根据宪法，制定本法。",
        "keywords": "民法典,立法目的,宪法",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第二条 - 民法调整范围",
        "category": "民法典",
        "subcategory": "总则编",
        "content": "民法调整平等主体的自然人、法人和非法人组织之间的人身关系和财产关系。",
        "keywords": "民法,调整范围,人身关系,财产关系",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第三条 - 民事权益保护",
        "category": "民法典",
        "subcategory": "总则编",
        "content": "民事主体的人身权利、财产权利以及其他合法权益受法律保护，任何组织或者个人不得侵犯。",
        "keywords": "人身权利,财产权利,权益保护",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第四条 - 平等原则",
        "category": "民法典",
        "subcategory": "总则编",
        "content": "民事主体在民事活动中的法律地位一律平等。",
        "keywords": "平等原则,民事活动,法律地位",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第五条 - 自愿原则",
        "category": "民法典",
        "subcategory": "总则编",
        "content": "民事主体从事民事活动，应当遵循自愿原则，按照自己的意思设立、变更、终止民事法律关系。",
        "keywords": "自愿原则,民事活动,意思自治",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第六条 - 公平原则",
        "category": "民法典",
        "subcategory": "总则编",
        "content": "民事主体从事民事活动，应当遵循公平原则，合理确定各方的权利和义务。",
        "keywords": "公平原则,权利义务",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第七条 - 诚信原则",
        "category": "民法典",
        "subcategory": "总则编",
        "content": "民事主体从事民事活动，应当遵循诚信原则，秉持诚实，恪守承诺。",
        "keywords": "诚信原则,诚实守信",
        "source": "《中华人民共和国民法典》"
    },
    
    # 民法典 - 合同编
    {
        "title": "民法典第四百六十四条 - 合同定义",
        "category": "民法典",
        "subcategory": "合同编",
        "content": "合同是民事主体之间设立、变更、终止民事法律关系的协议。婚姻、收养、监护等有关身份关系的协议，适用有关该身份关系的法律规定；没有规定的，可以根据其性质参照适用本编规定。",
        "keywords": "合同定义,民事法律关系,协议",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第四百六十九条 - 合同形式",
        "category": "民法典",
        "subcategory": "合同编",
        "content": "当事人订立合同，可以采用书面形式、口头形式或者其他形式。书面形式是合同书、信件、电报、电传、传真等可以有形地表现所载内容的形式。以电子数据交换、电子邮件等方式能够有形地表现所载内容，并可以随时调取查用的数据电文，视为书面形式。",
        "keywords": "合同形式,书面形式,口头形式,电子合同",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第五百零九条 - 合同履行原则",
        "category": "民法典",
        "subcategory": "合同编",
        "content": "当事人应当按照约定全面履行自己的义务。当事人应当遵循诚信原则，根据合同的性质、目的和交易习惯履行通知、协助、保密等义务。当事人在履行合同过程中，应当避免浪费资源、污染环境和破坏生态。",
        "keywords": "合同履行,诚信原则,全面履行",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第五百七十七条 - 违约责任",
        "category": "民法典",
        "subcategory": "合同编",
        "content": "当事人一方不履行合同义务或者履行合同义务不符合约定的，应当承担继续履行、采取补救措施或者赔偿损失等违约责任。",
        "keywords": "违约责任,继续履行,赔偿损失",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第五百八十四条 - 损失赔偿范围",
        "category": "民法典",
        "subcategory": "合同编",
        "content": "当事人一方不履行合同义务或者履行合同义务不符合约定，造成对方损失的，损失赔偿额应当相当于因违约所造成的损失，包括合同履行后可以获得的利益；但是，不得超过违约一方订立合同时预见到或者应当预见到的因违约可能造成的损失。",
        "keywords": "损失赔偿,可得利益,预见规则",
        "source": "《中华人民共和国民法典》"
    },
    
    # 民法典 - 婚姻家庭编
    {
        "title": "民法典第一千零四十一条 - 婚姻家庭基本原则",
        "category": "民法典",
        "subcategory": "婚姻家庭编",
        "content": "婚姻家庭受国家保护。实行婚姻自由、一夫一妻、男女平等的婚姻制度。保护妇女、未成年人、老年人、残疾人的合法权益。",
        "keywords": "婚姻自由,一夫一妻,男女平等",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第一千零四十六条 - 结婚条件",
        "category": "民法典",
        "subcategory": "婚姻家庭编",
        "content": "结婚应当男女双方完全自愿，禁止任何一方对另一方加以强迫，禁止任何组织或者个人加以干涉。",
        "keywords": "结婚条件,自愿原则,禁止强迫",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第一千零四十七条 - 法定婚龄",
        "category": "民法典",
        "subcategory": "婚姻家庭编",
        "content": "结婚年龄，男不得早于二十二周岁，女不得早于二十周岁。",
        "keywords": "法定婚龄,结婚年龄,男22女20",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第一千零七十六条 - 协议离婚",
        "category": "民法典",
        "subcategory": "婚姻家庭编",
        "content": "夫妻双方自愿离婚的，应当签订书面离婚协议，并亲自到婚姻登记机关申请离婚登记。离婚协议应当载明双方自愿离婚的意思表示和对子女抚养、财产以及债务处理等事项协商一致的意见。",
        "keywords": "协议离婚,离婚协议,子女抚养,财产分割",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第一千零七十九条 - 诉讼离婚",
        "category": "民法典",
        "subcategory": "婚姻家庭编",
        "content": "夫妻一方要求离婚的，可以由有关组织进行调解或者直接向人民法院提起离婚诉讼。人民法院审理离婚案件，应当进行调解；如果感情确已破裂，调解无效的，应当准予离婚。有下列情形之一，调解无效的，应当准予离婚：（一）重婚或者与他人同居；（二）实施家庭暴力或者虐待、遗弃家庭成员；（三）有赌博、吸毒等恶习屡教不改；（四）因感情不和分居满二年；（五）其他导致夫妻感情破裂的情形。",
        "keywords": "诉讼离婚,感情破裂,家庭暴力,分居",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第一千零八十七条 - 离婚财产分割",
        "category": "民法典",
        "subcategory": "婚姻家庭编",
        "content": "离婚时，夫妻的共同财产由双方协议处理；协议不成的，由人民法院根据财产的具体情况，按照照顾子女、女方和无过错方权益的原则判决。对夫或者妻在家庭土地承包经营中享有的权益等，应当依法予以保护。",
        "keywords": "财产分割,共同财产,照顾子女,照顾女方",
        "source": "《中华人民共和国民法典》"
    },
    
    # 劳动法
    {
        "title": "劳动法第三条 - 劳动者权利",
        "category": "劳动法",
        "subcategory": "总则",
        "content": "劳动者享有平等就业和选择职业的权利、取得劳动报酬的权利、休息休假的权利、获得劳动安全卫生保护的权利、接受职业技能培训的权利、享受社会保险和福利的权利、提请劳动争议处理的权利以及法律规定的其他劳动权利。",
        "keywords": "劳动者权利,平等就业,劳动报酬,休息休假",
        "source": "《中华人民共和国劳动法》"
    },
    {
        "title": "劳动法第三十六条 - 工作时间",
        "category": "劳动法",
        "subcategory": "工作时间和休息休假",
        "content": "国家实行劳动者每日工作时间不超过八小时、平均每周工作时间不超过四十四小时的工时制度。",
        "keywords": "工作时间,八小时,四十四小时",
        "source": "《中华人民共和国劳动法》"
    },
    {
        "title": "劳动法第四十四条 - 加班工资",
        "category": "劳动法",
        "subcategory": "工资",
        "content": "有下列情形之一的，用人单位应当按照下列标准支付高于劳动者正常工作时间工资的工资报酬：（一）安排劳动者延长工作时间的，支付不低于工资的百分之一百五十的工资报酬；（二）休息日安排劳动者工作又不能安排补休的，支付不低于工资的百分之二百的工资报酬；（三）法定休假日安排劳动者工作的，支付不低于工资的百分之三百的工资报酬。",
        "keywords": "加班工资,延长工作时间,休息日,法定休假日,1.5倍,2倍,3倍",
        "source": "《中华人民共和国劳动法》"
    },
    {
        "title": "劳动合同法第十条 - 书面劳动合同",
        "category": "劳动合同法",
        "subcategory": "劳动合同的订立",
        "content": "建立劳动关系，应当订立书面劳动合同。已建立劳动关系，未同时订立书面劳动合同的，应当自用工之日起一个月内订立书面劳动合同。用人单位与劳动者在用工前订立劳动合同的，劳动关系自用工之日起建立。",
        "keywords": "书面劳动合同,用工之日,一个月",
        "source": "《中华人民共和国劳动合同法》"
    },
    {
        "title": "劳动合同法第三十七条 - 劳动者单方解除",
        "category": "劳动合同法",
        "subcategory": "劳动合同的解除和终止",
        "content": "劳动者提前三十日以书面形式通知用人单位，可以解除劳动合同。劳动者在试用期内提前三日通知用人单位，可以解除劳动合同。",
        "keywords": "单方解除,提前三十日,试用期,提前三日",
        "source": "《中华人民共和国劳动合同法》"
    },
    {
        "title": "劳动合同法第四十七条 - 经济补偿",
        "category": "劳动合同法",
        "subcategory": "劳动合同的解除和终止",
        "content": "经济补偿按劳动者在本单位工作的年限，每满一年支付一个月工资的标准向劳动者支付。六个月以上不满一年的，按一年计算；不满六个月的，向劳动者支付半个月工资的经济补偿。劳动者月工资高于用人单位所在直辖市、设区的市级人民政府公布的本地区上年度职工月平均工资三倍的，向其支付经济补偿的标准按职工月平均工资三倍的数额支付，向其支付经济补偿的年限最高不超过十二年。",
        "keywords": "经济补偿,N+1,工作年限,月工资",
        "source": "《中华人民共和国劳动合同法》"
    },
    {
        "title": "劳动合同法第八十二条 - 未签合同双倍工资",
        "category": "劳动合同法",
        "subcategory": "法律责任",
        "content": "用人单位自用工之日起超过一个月不满一年未与劳动者订立书面劳动合同的，应当向劳动者每月支付二倍的工资。用人单位违反本法规定不与劳动者订立无固定期限劳动合同的，自应当订立无固定期限劳动合同之日起向劳动者每月支付二倍的工资。",
        "keywords": "双倍工资,未签合同,一个月,一年",
        "source": "《中华人民共和国劳动合同法》"
    },
    
    # 消费者权益保护法
    {
        "title": "消费者权益保护法第七条 - 安全权",
        "category": "消费者权益保护法",
        "subcategory": "消费者的权利",
        "content": "消费者在购买、使用商品和接受服务时享有人身、财产安全不受损害的权利。消费者有权要求经营者提供的商品和服务，符合保障人身、财产安全的要求。",
        "keywords": "安全权,人身安全,财产安全",
        "source": "《中华人民共和国消费者权益保护法》"
    },
    {
        "title": "消费者权益保护法第八条 - 知情权",
        "category": "消费者权益保护法",
        "subcategory": "消费者的权利",
        "content": "消费者享有知悉其购买、使用的商品或者接受的服务的真实情况的权利。消费者有权根据商品或者服务的不同情况，要求经营者提供商品的价格、产地、生产者、用途、性能、规格、等级、主要成份、生产日期、有效期限、检验合格证明、使用方法说明书、售后服务，或者服务的内容、规格、费用等有关情况。",
        "keywords": "知情权,真实情况,商品信息",
        "source": "《中华人民共和国消费者权益保护法》"
    },
    {
        "title": "消费者权益保护法第二十五条 - 七天无理由退货",
        "category": "消费者权益保护法",
        "subcategory": "经营者的义务",
        "content": "经营者采用网络、电视、电话、邮购等方式销售商品，消费者有权自收到商品之日起七日内退货，且无需说明理由，但下列商品除外：（一）消费者定作的；（二）鲜活易腐的；（三）在线下载或者消费者拆封的音像制品、计算机软件等数字化商品；（四）交付的报纸、期刊。除前款所列商品外，其他根据商品性质并经消费者在购买时确认不宜退货的商品，不适用无理由退货。",
        "keywords": "七天无理由退货,网购,退货,退款",
        "source": "《中华人民共和国消费者权益保护法》"
    },
    {
        "title": "消费者权益保护法第五十五条 - 欺诈赔偿",
        "category": "消费者权益保护法",
        "subcategory": "法律责任",
        "content": "经营者提供商品或者服务有欺诈行为的，应当按照消费者的要求增加赔偿其受到的损失，增加赔偿的金额为消费者购买商品的价款或者接受服务的费用的三倍；增加赔偿的金额不足五百元的，为五百元。法律另有规定的，依照其规定。",
        "keywords": "欺诈,三倍赔偿,假一赔三,五百元",
        "source": "《中华人民共和国消费者权益保护法》"
    },
    
    # 刑法
    {
        "title": "刑法第二百三十二条 - 故意杀人罪",
        "category": "刑法",
        "subcategory": "侵犯公民人身权利、民主权利罪",
        "content": "故意杀人的，处死刑、无期徒刑或者十年以上有期徒刑；情节较轻的，处三年以上十年以下有期徒刑。",
        "keywords": "故意杀人罪,死刑,无期徒刑",
        "source": "《中华人民共和国刑法》"
    },
    {
        "title": "刑法第二百三十四条 - 故意伤害罪",
        "category": "刑法",
        "subcategory": "侵犯公民人身权利、民主权利罪",
        "content": "故意伤害他人身体的，处三年以下有期徒刑、拘役或者管制。犯前款罪，致人重伤的，处三年以上十年以下有期徒刑；致人死亡或者以特别残忍手段致人重伤造成严重残疾的，处十年以上有期徒刑、无期徒刑或者死刑。",
        "keywords": "故意伤害罪,轻伤,重伤,有期徒刑",
        "source": "《中华人民共和国刑法》"
    },
    {
        "title": "刑法第二百六十四条 - 盗窃罪",
        "category": "刑法",
        "subcategory": "侵犯财产罪",
        "content": "盗窃公私财物，数额较大的，或者多次盗窃、入户盗窃、携带凶器盗窃、扒窃的，处三年以下有期徒刑、拘役或者管制，并处或者单处罚金；数额巨大或者有其他严重情节的，处三年以上十年以下有期徒刑，并处罚金；数额特别巨大或者有其他特别严重情节的，处十年以上有期徒刑或者无期徒刑，并处罚金或者没收财产。",
        "keywords": "盗窃罪,数额较大,入户盗窃,扒窃",
        "source": "《中华人民共和国刑法》"
    },
    {
        "title": "刑法第二百六十六条 - 诈骗罪",
        "category": "刑法",
        "subcategory": "侵犯财产罪",
        "content": "诈骗公私财物，数额较大的，处三年以下有期徒刑、拘役或者管制，并处或者单处罚金；数额巨大或者有其他严重情节的，处三年以上十年以下有期徒刑，并处罚金；数额特别巨大或者有其他特别严重情节的，处十年以上有期徒刑或者无期徒刑，并处罚金或者没收财产。",
        "keywords": "诈骗罪,电信诈骗,网络诈骗,数额较大",
        "source": "《中华人民共和国刑法》"
    },
    
    # 道路交通安全法
    {
        "title": "道路交通安全法第七十六条 - 交通事故责任",
        "category": "道路交通安全法",
        "subcategory": "交通事故处理",
        "content": "机动车发生交通事故造成人身伤亡、财产损失的，由保险公司在机动车第三者责任强制保险责任限额范围内予以赔偿；不足的部分，按照下列规定承担赔偿责任：（一）机动车之间发生交通事故的，由有过错的一方承担赔偿责任；双方都有过错的，按照各自过错的比例分担责任。（二）机动车与非机动车驾驶人、行人之间发生交通事故，非机动车驾驶人、行人没有过错的，由机动车一方承担赔偿责任；有证据证明非机动车驾驶人、行人有过错的，根据过错程度适当减轻机动车一方的赔偿责任；机动车一方没有过错的，承担不超过百分之十的赔偿责任。",
        "keywords": "交通事故,责任划分,保险赔偿,过错责任",
        "source": "《中华人民共和国道路交通安全法》"
    },
    {
        "title": "道路交通安全法第九十一条 - 醉驾处罚",
        "category": "道路交通安全法",
        "subcategory": "法律责任",
        "content": "饮酒后驾驶机动车的，处暂扣六个月机动车驾驶证，并处一千元以上二千元以下罚款。因饮酒后驾驶机动车被处罚，再次饮酒后驾驶机动车的，处十日以下拘留，并处一千元以上二千元以下罚款，吊销机动车驾驶证。醉酒驾驶机动车的，由公安机关交通管理部门约束至酒醒，吊销机动车驾驶证，依法追究刑事责任；五年内不得重新取得机动车驾驶证。",
        "keywords": "酒驾,醉驾,吊销驾照,刑事责任",
        "source": "《中华人民共和国道路交通安全法》"
    },
    
    # 侵权责任法（民法典侵权责任编）
    {
        "title": "民法典第一千一百六十五条 - 过错责任原则",
        "category": "民法典",
        "subcategory": "侵权责任编",
        "content": "行为人因过错侵害他人民事权益造成损害的，应当承担侵权责任。依照法律规定推定行为人有过错，其不能证明自己没有过错的，应当承担侵权责任。",
        "keywords": "过错责任,侵权责任,举证责任",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第一千一百七十九条 - 人身损害赔偿",
        "category": "民法典",
        "subcategory": "侵权责任编",
        "content": "侵害他人造成人身损害的，应当赔偿医疗费、护理费、交通费、营养费、住院伙食补助费等为治疗和康复支出的合理费用，以及因误工减少的收入。造成残疾的，还应当赔偿辅助器具费和残疾赔偿金；造成死亡的，还应当赔偿丧葬费和死亡赔偿金。",
        "keywords": "人身损害赔偿,医疗费,误工费,残疾赔偿金,死亡赔偿金",
        "source": "《中华人民共和国民法典》"
    },
    {
        "title": "民法典第一千一百九十一条 - 用人单位责任",
        "category": "民法典",
        "subcategory": "侵权责任编",
        "content": "用人单位的工作人员因执行工作任务造成他人损害的，由用人单位承担侵权责任。用人单位承担侵权责任后，可以向有故意或者重大过失的工作人员追偿。劳务派遣期间，被派遣的工作人员因执行工作任务造成他人损害的，由接受劳务派遣的用工单位承担侵权责任；劳务派遣单位有过错的，承担相应的责任。",
        "keywords": "用人单位责任,雇主责任,工作任务,追偿",
        "source": "《中华人民共和国民法典》"
    },
]


async def seed_legal_knowledge():
    """填充法律知识数据"""
    await init_db()
    
    async with AsyncSessionLocal() as session:
        # 检查是否已有数据
        from sqlalchemy import select, func
        count_result = await session.execute(
            select(func.count()).select_from(LegalKnowledge)
        )
        existing_count = count_result.scalar() or 0
        
        if existing_count > 0:
            print(f"法律知识库已有 {existing_count} 条数据")
            user_input = input("是否清空并重新填充? (y/n): ")
            if user_input.lower() != 'y':
                print("取消操作")
                return
            
            # 清空现有数据
            await session.execute(LegalKnowledge.__table__.delete())
            await session.commit()
            print("已清空现有数据")
        
        # 插入新数据
        for item in LEGAL_KNOWLEDGE_DATA:
            knowledge = LegalKnowledge(
                title=item["title"],
                category=item["category"],
                subcategory=item.get("subcategory"),
                content=item["content"],
                keywords=item.get("keywords"),
                source=item.get("source"),
                is_active=True
            )
            session.add(knowledge)
        
        await session.commit()
        print(f"成功填充 {len(LEGAL_KNOWLEDGE_DATA)} 条法律知识数据")
        
        # 统计各分类数量
        print("\n各分类数量统计:")
        categories = {}
        for item in LEGAL_KNOWLEDGE_DATA:
            cat = item["category"]
            categories[cat] = categories.get(cat, 0) + 1
        
        for cat, count in sorted(categories.items()):
            print(f"  {cat}: {count} 条")


if __name__ == "__main__":
    asyncio.run(seed_legal_knowledge())
